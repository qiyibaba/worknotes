在OceanBase 2.2.77版本和3.1.2版本中官方文档指出如下两个常见问题：

- ​代价模型缺陷导致的执行计划选择错误
  
  OceanBase 数据库内建的代价模型是服务器的固有逻辑，最佳执行计划依赖此代价模型。因此，一旦出现由代价模型导致的计划选择错误，用户只能通过执行计划绑定来确保选择"正确"的执行计划。

- 数据统计信息不准确
  
  查询优化过程依赖数据统计信息的准确性，OceanBase 数据库的优化器默认会在数据合并过程中收集统计信息，当用对数据进行了大量修改时，可能会导致统计信息落后于真实数据的特征，用户可以通过发起每日合并，主动更新统计信息。除了优化器收集的统计信息以外，优化        器还会根据查询条件对存储层进行采样，用以后续的优化选择。OceanBase 数据库目前仅支持对本地存储进行采样，对于数据分区在远程节点上的情况，只能使用默认收集的统计信息进行代价估计，可能会引入代价偏差。

- 针对问题一，我们想请教下可以通过什么手段对执行计划改变进行监控，更具体地，如何知道计划选择是否是正确的呢？
  
  答复：可以使用OCP或者使用表进行查询
  
  - 使用 `EXPLAIN` 命令可以展示出当前优化器所生成的执行计划，但由于统计信息变化、用户 session 变量设置变化等，会造成该 SQL 在计划缓存中实际对应的计划可能与 `EXPLAIN` 的结果并不相同。为了确定该 SQL 在系统中实际使用的执行计划，需要进一步分析计划缓存中的物理执行计划。用户可以通过查询 `(g)v$plan_cache_plan_explain` 视图来展示某条 SQL 在计划缓存中的执行计划,视图定义如下所示：
    
    ```sql
    VIEW_DEFINITION='SELECT * 
                     FROM oceanbase.gv$plan_cache_plan_explain
                     WHERE IP =host_ip() AND PORT = rpc_port()'
    ```
  
  - 使用OCP界面查询执行计划

- 针对问题二，如果统计信息落后真实数据，是否执行计划会受到影响导致选择了不好的执行计划？
  
  答复：会，合并后存储层的统计信息会更新，增量数据一般相比旧数据少，一般不会出现统计信息偏差很差的情况。如果大批量导入数据，建议合并或者手动收集统计信息。

- 另外每日合并动作是管理员发起的，用户无法发起每日合并，针对这种情况如何应对呢？
  
  答复：合并触发有三种触发方式：自动触发、定时触发与手动触发。
  
  - 当集群中任一租户的 Minor Freeze 次数超过阈值时，就会自动触发整个集群的合并。
  
  - 也可以通过设置参数来在每天的业务低峰期定时触发合并。
    
    ```sql
    obclient> ALTER SYSTEM SET major_freeze_duty_time = '02:00';
    ```
  
  - 也通过以下的运维命令手动触发合并。
    
    ```sql
    obclient> ALTER SYSTEM MAJOR FREEZE;
    ```
  
  - 由于合并会占用较大的系统资源，所以我们不建议客户手工发起合并操作，同时也尽量避免由于转储次数达到阈值后出发合并，仅使用每日合并；但在某一些场景下可以使用手工合并，比如刚进行全量迁移后的集群，可提前做一次合并。

- 数据分区在远程节点上的情况，只能使用默认收集的统计信息进行代价估计，可能会引入代价偏差。这个的影响是执行计划变差是么？
  
  答复，是的，其实就是远程代价不准的问题，也只能使用问题2的方式进行一些信息收集
